{% load static %}
<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>T07FakeMediaDetect - Ph√°t hi·ªán Gi·∫£ m·∫°o ·∫¢nh</title>
    <meta name="description" content="H·ªá th·ªëng T07 - Ph√¢n t√≠ch v√† ph√°t hi·ªán gi·∫£ m·∫°o ·∫£nh s·ª≠ d·ª•ng AI v√† ELA">
    <link rel="stylesheet" href="{% static 'assets/bootstrap/css/bootstrap.min.css' %}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'assets/css/style_v2.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/magnify/2.3.3/css/magnify.css" integrity="sha512-JxBFHHd+xyHl++SdVJYCCgxGPJKCTTaqndOl/n12qI73hgj7PuGuYDUcCgtdSHTeXSHCtW4us4Qmv+xwPqKVjQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body style="padding-top: 80px;">
<nav class="navbar navbar-dark navbar-expand-lg fixed-top navbar-custom">
    <div class="container">
        <a class="navbar-brand" href="{% url 'index' %}">
            <img src="{% static 'assets/img/logo.png' %}" alt="T07FakeMediaDetect Logo" style="height:40px;">
            <span style="font-size: 0.95rem;">T07FakeMediaDetect</span>
        </a>
        <button data-toggle="collapse" class="navbar-toggler" data-target="#navbarResponsive">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="nav navbar-nav ml-auto">
                <li class="nav-item"><a class="nav-link active" href="{% url 'image' %}">·∫¢nh</a></li>
                <li class="nav-item"><a class="nav-link" href="{% url 'video' %}">Video</a></li>
                <li class="nav-item"><a class="nav-link" href="{% url 'pdf' %}">PDF</a></li>
            </ul>
        </div>
    </div>
</nav>
<div class="t07-section">
    <div class="container">
        <div class="t07-page-header">
            <h1>üñºÔ∏è Ph√°t hi·ªán Gi·∫£ m·∫°o ·∫¢nh</h1>
            <p class="page-subtitle">Ph√¢n t√≠ch t√≠nh x√°c th·ª±c v√† ph√°t hi·ªán d·∫•u hi·ªáu ch·ªânh s·ª≠a b·∫±ng AI</p>
        </div>
        
        <div class="row">
            <div class="col-lg-6 mb-4">
                <div class="t07-card">
                    <h4>üì§ T·∫£i ·∫£nh & Ph√¢n t√≠ch</h4>
                    <form method="POST" action="runAnalysis" enctype="multipart/form-data">
                        {% csrf_token %}
                        <div class="form-group mb-3">
                            <label for="input_image" style="color: var(--text-secondary); margin-bottom: 0.5rem; display: block;">Ch·ªçn ·∫£nh ƒë·ªÉ ph√¢n t√≠ch:</label>
                            <input type="file" id="input_image" name="input_image" onchange="loadFile(event)" accept="image/*">
                        </div>
                        
                        <div class="t07-media-box mb-3">
                            <img id="upl_img" src='{{ input_image }}' class="zoom img-fluid" data-magnify-src='{{ input_image }}'
                                 onerror="this.src='https://via.placeholder.com/600x400/0f172a/06b6d4?text=Ch·ªçn+·∫£nh+ƒë·ªÉ+ph√¢n+t√≠ch'" 
                                 style="object-fit: contain;">
                        </div>
                        
                        <button class="btn btn-primary btn-block" type="submit" name="run" value="run" style="padding: 0.875rem; font-size: 1rem; font-weight: 600;">
                            üîç B·∫Øt ƒë·∫ßu Ph√¢n t√≠ch
                        </button>
                        
                        {% if result.type %}
                        <div class="alert alert-success mt-3" role="alert">
                            <h5 style="margin-bottom: 0.75rem; font-weight: 700;">üìä K·∫øt qu·∫£ Ph√¢n t√≠ch</h5>
                            <div style="font-size: 1.05rem;">
                                <p style="margin-bottom: 0.5rem;">Tr·∫°ng th√°i: <b style="font-size: 1.2rem;">{{ result.type }}</b></p>
                                <p style="margin-bottom: 0;">ƒê·ªô tin c·∫≠y: <b style="font-size: 1.2rem;">{{ result.confidence }}%</b></p>
                                <p style="font-weight: normal; font-size: 0.95rem; margin-top: 0.5rem; color: var(--text-secondary);" id="identicalreg"></p>
                            </div>
                        </div>
                        {% endif %}
                    </form>
                    
                    {% if metadata %}
                    <div class="mt-4">
                        <h4>üìã Si√™u d·ªØ li·ªáu (Metadata)</h4>
                        <div class="t07-table">
                            <table class="table table-bordered table-striped table-dark table-hover">
                                <thead>
                                    <tr>
                                        <th style="width: 40%;">Thu·ªôc t√≠nh</th>
                                        <th>Gi√° tr·ªã</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for key, value in metadata %}
                                    <tr>
                                        <td><strong>{{key}}</strong></td>
                                        <td>{{value}}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
            <div class="col-lg-6 mb-4" id="imagegenerationSecton">
                <div class="t07-card">
                    <h4>üî¨ C√¥ng c·ª• Ph√¢n t√≠ch Forensics</h4>
                    <p class="t07-muted mb-3">Ch·ªçn c√¥ng c·ª• ph√¢n t√≠ch ƒë·ªÉ hi·ªÉn th·ªã c√°c d·∫•u hi·ªáu gi·∫£ m·∫°o:</p>
                    
                    <form method="POST" action="getImages" enctype="multipart/form-data">
                        {% csrf_token %}
                        <div class="t07-forensic-grid">
                            <button id="maskButton" class="t07-forensic-btn" type="submit" name="mask" value="mask" style="display: none;">
                                <span>üé≠</span>
                                <span>M·∫∑t n·∫°</span>
                            </button>
                            <button class="t07-forensic-btn" type="submit" name="ela" value="ela">
                                <span>üì∏</span>
                                <span>ELA</span>
                            </button>
                            <button class="t07-forensic-btn" type="submit" name="edge_map" value="edge_map">
                                <span>üó∫Ô∏è</span>
                                <span>B·∫£n ƒë·ªì bi√™n</span>
                            </button>
                            <button class="t07-forensic-btn" type="submit" name="lum_gradiend" value="lum_gradiend">
                                <span>üí°</span>
                                <span>ƒê·ªô ch√≥i</span>
                            </button>
                            <button class="t07-forensic-btn" type="submit" name="na" value="na">
                                <span>üîä</span>
                                <span>Ph√¢n t√≠ch nhi·ªÖu</span>
                            </button>
                            <button class="t07-forensic-btn" type="submit" name="copy_move_sift" value="copy_move_sift">
                                <span>üìã</span>
                                <span>Sao ch√©p-Move</span>
                            </button>
                        </div>
                        
                        <div class="t07-media-box">
                            <img id="output_img" alt='K·∫øt qu·∫£ ph√¢n t√≠ch' src="{{ url }}" class="zoom2 img-fluid" data-magnify-src='{{ url }}'
                                 onerror="this.src='https://via.placeholder.com/600x400/0f172a/06b6d4?text=Ch·ªçn+c√¥ng+c·ª•+ph√¢n+t√≠ch'">
                        </div>
                    </form>
                    
                    <div class="t07-info-box">
                        <p>
                            <strong>üí° M·∫πo:</strong> Click v√†o ·∫£nh ƒë·ªÉ ph√≥ng to v√† xem chi ti·∫øt. C√°c v√πng m√†u kh√°c bi·ªát trong k·∫øt qu·∫£ ph√¢n t√≠ch th∆∞·ªùng ch·ªâ ra c√°c v√πng ƒë√£ b·ªã ch·ªânh s·ª≠a.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<footer class="py-5 bg-black">
    <div class="container">
        <p class="text-center text-white m-0 small">¬© 2025 T07FakeMediaDetect - H·ªá th·ªëng ph√°t hi·ªán t·ªáp ƒëa ph∆∞∆°ng ti·ªán gi·∫£ m·∫°o T07 | Powered by Deep Learning & AI</p>
    </div>
</footer>
<script src="{% static 'assets/js/jquery.min.js' %}"></script>
<script src="{% static 'assets/bootstrap/js/bootstrap.min.js' %}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/magnify/2.3.3/js/jquery.magnify.min.js" integrity="sha512-YKxHqn7D0M5knQJO2xKHZpCfZ+/Ta7qpEHgADN+AkY2U2Y4JJtlCEHzKWV5ZE87vZR3ipdzNJ4U/sfjIaoHMfw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
$(document).ready(function() {
  $('.zoom').magnify();
});
</script>
<script>
$(document).ready(function() {
  $('.zoom2').magnify();
});
</script>
<script>
    // File upload preview
    var loadFile = function (event) {
        var input_image = document.getElementById('upl_img');
        if (event.target.files && event.target.files[0]) {
            input_image.src = URL.createObjectURL(event.target.files[0]);
        }
    };
    
    // Handle forensic tools section visibility
    var img_res = "{{result.type}}";
    var imagesSection = document.getElementById('imagegenerationSecton');
    var maskButton = document.getElementById('maskButton');

    // Show forensic section only if analysis has been run
    if (img_res && img_res !== '' && img_res !== 'L·ªói') {
        if (imagesSection) {
            imagesSection.style.display = "block";
        }
        
        // Show mask button only for forged images
        if (maskButton) {
            if (img_res === "Forged") {
                maskButton.style.display = "inline-block";
            } else {
                maskButton.style.display = "none";
            }
        }
    } else {
        // Hide forensic section if no analysis yet or error
        if (imagesSection) {
            imagesSection.style.display = "none";
        }
    }
    
    // Log for debugging
    console.log('Image result type:', img_res);
    console.log('Forensic section visible:', imagesSection ? imagesSection.style.display : 'N/A');
</script>
</body>

</html>